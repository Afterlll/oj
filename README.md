# 江喜原 AC

## 项目介绍

基于 Spring Cloud 微服务 + MQ + Docker + Vue 3 + Arco Design 的编程题目评测系统。用户提交代码之后，系统调用判题服务执行代码和评测，帮助用户**AC**；系统中 **自主实现的代码沙箱** 作为独立服务可供第三方调用。



## 主要工作

* 系统集成 **ByteMD** 和 **Monaco Editor** ，自行封装实现可复用的 **Markdown** 文本编辑器组件和 **Editor** 代码编辑器组件，支持表格语法、多种编程语言的高亮。
* 实现了代码沙箱环境的**高安全性** ，使用 **Docker** 容器技术实现了宿主机的环境隔离，使用 **Java安全管理器**和自定义的 **Security Manager** 进行用户代码的权限控制，使用 **HostConfig** 实现容器的内存限制和网络隔离，控制超时时间。
* 为防止用户恶意请求代码沙箱服务，采用 **API 签名认证**的方式，给调用方分配签名密钥，并通过校验请求头中的密钥保证了 API 调用安全。
* 为进一步提高系统的判题效率，系统采用**异步**的方式，题目服务将即将要进行判题的id发送至 RabbitMQ 消息队列，并通过 Direct 交换机转发给判题队列，由判题服务进行消费，异步更新题目状态。相比于同步，不仅实现了服务之间的**解耦**，而且响应时间由 **1.5** 秒减少至 **0.3** 秒，系统 qps 提升了 **80%**。
* 为保证项目各模块的稳定性，使用 Spring Cloud Alibaba 重构单体项目，实现服务划分、服务降级、服务限流、分布式登录、在 Gateway 层面实现接口文档的统一聚合和全局权限校验。
* 实现了**远程**、**第三方**代码沙箱多种代码沙箱实现，并通过 **静态工厂模式 + Spring 配置化**的方式实现灵活调用，使用 **代码模式** 增强代码沙箱能力，使用 **策略模式** 执行不同的判题算法，提高系统的可维护性。
* 为提高系统的健壮性，调整虚拟机参数，使用 **JVM -XMX -Xms** 限制用户程序占用的最大堆内存。



## 架构设计

![image-20240519121638270](https://github.com/Afterlll/oj/assets/116958691/4c2ced4e-bebf-4fa5-9cdd-cd40470c82bb)





## 核心业务流程

![image-20240519121445415](https://github.com/Afterlll/oj/assets/116958691/a03f9ea4-10a8-48dc-8e03-788c7507b0cc)

![image-20240519121530120](https://github.com/Afterlll/oj/assets/116958691/edfb550c-a7d8-42b9-9d4e-43781bb53d7f)



## 功能

1. 题目模块
   * 创建题目（管理员）
   * 删除题目（管理员）
   * 修改题目（管理员）
   * 搜索题目（用户）
   * 在线做题
   * 提交题目代码
2. 用户模块
   * 注册
   * 登录
3. 判题模块
   * 提交判题（结果是否正确与错误）
   * 错误处理（内存溢出、安全性、超时）
   * **代码沙箱**（安全沙箱）
   * 开发接口（提供一个新的服务）





## 技术选型

### 前端

* Vue3
* Vue-CLI 脚手架
* Arco Design 组件库
* 前端工程化：ESLint + Prettier+ TypeScript
* 前端项目模板（通用布局、权限管理、状态管理、菜单生成）
* Markdown 富文本编辑器
* Monaco Editor 代码编辑器
* OpenAPI 前端代码生成



### 后端

* Java Spring Cloud + Spring Cloud Alibaba 微服务	
  *  Nacos 注册中心
  * OpenFeign 客户端调用
  * GateWay 网关
  * 聚合接口文档
* Java 进程控制
  * Java 安全管理器
  * Docker 代码沙箱实现
  * 虚拟机 （云服务器）+ 远程开发
* MySQL 数据库、MyBatis-Plus 及 Mybatis X 自动生成
* Redis 分布式 Session
* RabbitMQ 消息队列
* 多种设计模式
  * 策略模式
  * 工厂模式
  * 代理模式
  * 模板方法模式
* 并发编程
* JVM



## 判题机架构

![image-20240519131623087](https://github.com/Afterlll/oj/assets/116958691/05ccbc85-4d7e-441c-bd1f-f1cd03aa005e)
